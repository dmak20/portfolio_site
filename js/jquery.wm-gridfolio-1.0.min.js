/*!
 * jquery.wm-gridfolio - v 1.0
 * desenvolvido por Welison Menezes
 * email : welisonmenezes@gmail.com
 * 
 *
 * Copyright 2014 Welison Menezes
 * @license http://www.opensource.org/licenses/mit-license.html MIT License
 * @license http://www.gnu.org/licenses/gpl.html GPL2 License 
 */

(function(e){"use strict";e.fn.extend({WMGridfolio:function(t){var n={selectors:{item:"wmg-item",thumbnail:"wmg-thumbnail",details:"wmg-details",close:"wmg-close",arrow:"wmg-arrow"},thumbnail:{columns:6,minSize:100,margin:5},details:{minHeight:400,speed:350,full_w:false},config:{open:"open",openToTop:true,hasImg:true},callbacks:{CB_LoadGrid:false,CB_ResizeGrid:false,CB_OpenDetail:false,CB_CloseDetail:false,CB_CloseAll:false}},t=e.extend(true,n,t),r={container:false,element:false,thumbnail:false,details:false,close:false,CB_LoadGrid:function(){if(e.isFunction(t.callbacks.CB_LoadGrid)){t.callbacks.CB_LoadGrid.apply(this,arguments)}},CB_ResizeGrid:function(){if(e.isFunction(t.callbacks.CB_ResizeGrid)){t.callbacks.CB_ResizeGrid.apply(this,arguments)}},CB_OpenDetail:function(){if(e.isFunction(t.callbacks.CB_OpenDetail)){t.callbacks.CB_OpenDetail.apply(this,arguments)}},CB_CloseDetail:function(){if(e.isFunction(t.callbacks.CB_CloseDetail)){t.callbacks.CB_CloseDetail.apply(this,arguments)}},CB_CloseAll:function(){if(e.isFunction(t.callbacks.CB_CloseAll)){t.callbacks.CB_CloseAll.apply(this,arguments)}}},i={getWidthColumn:function(e){var n=e,r=n.width(),i=t.thumbnail.columns,s=r/i;while(s<=t.thumbnail.minSize){if(r<=t.thumbnail.minSize)return false;i=i-1;s=r/i}return s},openContent:function(n){var i=n,s=i.parent(),o=t.selectors.details,u=t.selectors.arrow,a=t.config.open,f=t.details.speed,l=e("."+o).find("> div").height(),c=t.selectors.close,h=l+(30-t.thumbnail.margin*2);i.addClass(a);i.parent().addClass(a);s.animate({"margin-bottom":h+"px"},f).addClass("wm-margin");s.find("."+o).stop().animate({height:h+"px"},f,function(){r.CB_OpenDetail()}).addClass(a);s.find("."+u).show();if(t.config.openToTop){if(s.offset()){var p=s.offset().top;e("html, body").animate({scrollTop:p},"500")}}r.container=s.parent();r.element=s;r.thumbnail=i;r.details=s.find("."+o);r.close=s.find("."+c)},closeContent:function(n,s){var o=n,u=s,a=t.selectors.details,f=t.selectors.thumbnail,l=t.selectors.item,c=t.selectors.arrow,h=t.selectors.close,p=t.config.open,d=t.details.speed;o.find("."+f).removeClass(p);o.find("."+l).removeClass(p);o.find(".wm-margin").animate({"margin-bottom":"0px"},d+50).removeClass(".wm-margin");o.find("."+a+"."+p).stop().animate({height:"0px"},d,function(){e(this).removeClass(p);if(u)i.openContent(u);r.CB_CloseDetail()});o.parent().find("."+c).hide();r.container=o;r.element=u===false?o.find("."+l):u.parent();r.thumbnail=u===false?o.find("."+f):u;r.details=u===false?o.find("."+a):u.parent().find("."+a);r.close=u===false?o.find("."+h):u.parent().find("."+h)}},s={dynamicCSS:function(n,r,s,o){var u=n,a=r,f=s,l=o,c=t.selectors.details,h=i.getWidthColumn(u),p=t.config.open,d=t.thumbnail.margin,v=f.width()/2-d*2,m=e("."+c).find("> div").height(),g=m+(30-d*2);if(e("."+c).hasClass(p)){e("."+t.selectors.item+"."+p).css({"margin-bottom":g+"px"});e("."+c+"."+p).css({height:g+"px"})}a.css({width:h+"px",height:h+"px"});l.css({left:v+"px"});if(t.config.hasImg){f.css({"line-height":Math.floor(h-d*2-1)+"px"});f.find("img").css({"max-width":Math.ceil(h-d*2)+"px","max-height":Math.ceil(h-d*2)+"px"})}},toogleContent:function(n,r){var s=n,o=r;o.each(function(){var n=e(this),r=t.config.open;n.on("click",function(){if(e(this).hasClass(r))return false;if(n.parent().parent().hasClass(r)){i.closeContent(s,n)}else{i.openContent(n)}n.parent().parent().addClass(r);return false})})},hideContent:function(n){n.on("click",function(){var n=e(this),s=n.parent().parent().parent(),o=t.config.open;i.closeContent(s,false);s.removeClass(o);r.CB_CloseAll()})},staticCSS:function(e,n,r,i,s){var o=e,u=n,a=r,f=i,l=s,c=t.thumbnail.margin;f.css({height:"0px"});f.find("> div").css({"min-height":t.details.minHeight});if(!t.details.full_w){f.find("> div").css({"margin-left":c,"margin-right":c})}u.css({padding:c+"px"})}};return this.each(function(){var n=e(this),i=n.find("."+t.selectors.item),o=n.find("."+t.selectors.thumbnail),u=n.find("."+t.selectors.details),a=n.find("."+t.selectors.close),f=n.find("."+t.selectors.arrow);r.container=n;r.element=i;r.thumbnail=o;r.details=u;r.close=a;s.staticCSS(n,i,o,u,f);s.toogleContent(n,o);s.hideContent(a);s.dynamicCSS(n,i,o,f);setTimeout(function(){s.dynamicCSS(n,i,o,f);r.CB_LoadGrid();n.css({filter:"alpha(opacity=100)",zoom:"1",opacity:"1"})},100);e(window).resize(function(){s.dynamicCSS(n,i,o,f);setTimeout(function(){s.dynamicCSS(n,i,o,f);r.CB_ResizeGrid()},100)})})}})})(jQuery);